!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){(function(t){var e=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function a(t){try{l(r.next(t))}catch(t){s(t)}}function o(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}l((r=r.apply(t,e||[])).next())}))};let n=t,r={allowUnicodeInStrings:!1,allowSuccessorML:!1,disableElaboration:!1,disableEvaluation:!1,allowLongFunctionNames:!1};class i{static init(){i.handlers={},i.nextId=1,i.freeIds=new Set,n.onmessage=function(t){let e=t.data;e.type&&i.handlers[e.type]&&i.handlers[e.type](e.data)},i.registerHandler("settings",t=>{t&&(r=JSON.parse(t))})}static registerHandler(t,e){i.handlers[t]=e}static clearHandler(t){delete i.handlers[t]}static sendPartialOutput(t){n.postMessage({type:"partial",data:t})}static sendOutputFinished(){n.postMessage({type:"finished",data:""})}static getCode(t){return new Promise((e,r)=>{n.postMessage({type:"getcode",data:t});let s=setTimeout(()=>{r("Timeout"),i.clearHandler("code")},1e3);i.registerHandler("code",t=>{i.clearHandler("code"),clearTimeout(s),e(t)})})}static markText(t,e,r){let s;if(i.freeIds.size>0){s=i.freeIds.values().next().value,i.freeIds.delete(s)}else s=i.nextId++;return n.postMessage({type:"markText",data:{from:t,to:e,style:r,id:s}}),s}static clearMarker(t){n.postMessage({type:"clearMarker",data:{id:t}})}static ping(){n.postMessage({type:"ping",data:""})}}var s;!function(t){t[t.OK=0]="OK",t[t.INCOMPLETE=1]="INCOMPLETE",t[t.INTERPRETER=2]="INTERPRETER",t[t.SML=3]="SML"}(s||(s={}));n.importScripts("/interpreter.js"),i.init(),(new class{constructor(){this.semicoli=[],this.data=[],this.disabled=!1,this.debounceCallNecessary=!1,this.interpreter=n.Interpreter,this.initialState=this.interpreter.getFirstState()}clear(){this.semicoli.length=0;for(let t=0;t<this.data.length;t++)-1!==this.data[t].marker&&i.clearMarker(this.data[t].marker);this.data.length=0}disable(){this.disabled=!0,this.clear()}enable(){this.disabled=!1}handleChangeAt(t,e,n){this.disabled||this.doDebounce(t,e,n)}go(){i.registerHandler("interpret",t=>{this.handleChangeAt(t.pos,t.added,t.removed)}),i.registerHandler("clear",t=>{this.clear()})}doDebounce(t,e,n){if(clearTimeout(this.debounceTimeout),!this.debounceCallNecessary){if(!this.isHandlingNecessary(t,e,n))return void i.ping();this.debounceCallNecessary=!0}this.debounceMinimumPosition&&-1!==this.compare(t,this.debounceMinimumPosition)||(this.debounceMinimumPosition=t),this.debounceTimeout=setTimeout(()=>{this.debounceTimeout=null,this.debounceCallNecessary=!1;let t=this.debounceMinimumPosition;this.debounceMinimumPosition=null,this.debouncedHandleChangeAt(t)},400)}debouncedHandleChangeAt(t){return e(this,void 0,void 0,(function*(){let e=this.binarySearch(t);e=this.findNonErrorAnchor(e),this.deleteAllAfter(e);let n,r=this.findBaseIndex(e);n=-1!==r?this.copyPos(this.semicoli[r]):{line:0,ch:0};let s=yield i.getCode(n);-1!==r&&(s=s.substr(1),n.ch=n.ch+1),this.sendFinishedData(r),this.reEvaluateFrom(n,r,e,s),i.sendOutputFinished()}))}sendFinishedData(t){let e="";for(let n=0;n<=t;n++)e+=this.data[n].output;i.sendPartialOutput(e)}copyPos(t){return{line:t.line,ch:t.ch}}reEvaluateFrom(t,e,n,r){let a=r.split("\n"),o=t,l="",u=!1,c=-1===e?null:this.data[e].state,h=-1===e?-1:this.data[e].successCounter;for(let r=0;r<a.length;r++){let d=0;0===r&&(d=t.ch);let p,g=-1,m=a[r];for(0!==r&&(l+="\n");-1!==(p=m.indexOf(";",g+1));){if(l+=m.substring(g+1,p),e>=n){let e={line:t.line+r,ch:p+d};if(u)this.addErrorSemicolon(e,"",i.markText(o,e,"eval-fail")),(o=this.copyPos(e)).ch++,c=null,l="";else{let t=this.evaluate(c,l);if(t.result===s.INCOMPLETE)this.addIncompleteSemicolon(e),l+=";";else if(t.result===s.OK){let n="eval-success";(h+1)%2==1&&(n="eval-success-odd"),this.addSemicolon(e,t.state,i.markText(o,e,n),t.warnings,++h),(o=this.copyPos(e)).ch++,c=t.state,l=""}else if(t.result===s.SML)this.addSMLErrorSemicolon(e,t.error,i.markText(o,e,"eval-fail")),(o=this.copyPos(e)).ch++,c=t.state,l="";else{let n=this.getErrorMessage(t.error,l,o);this.addErrorSemicolon(e,n,i.markText(o,e,"eval-fail")),(o=this.copyPos(e)).ch++,c=null,u=!0,l=""}if(this.data.length>0){let t=this.data[this.data.length-1].output;i.sendPartialOutput(t)}}}else l+=";";e++,g=p}l+=m.substr(g+1)}}evaluate(t,e){let n;try{n=null===t?this.interpreter.interpret(e+";",this.initialState,r):this.interpreter.interpret(e+";",t,r)}catch(t){return"Input Incomplete"===t.name?{state:null,result:s.INCOMPLETE,error:t,warnings:[]}:{state:null,result:s.INTERPRETER,error:t,warnings:[]}}return n.evaluationErrored?{state:n.state,result:s.SML,error:n.error,warnings:n.warnings}:{state:n.state,result:s.OK,error:null,warnings:n.warnings}}getErrorMessage(t,e,n){return"\\*"+this.outputEscape(t.name)+"\\*: "+this.outputEscape(t.message)}addSemicolon(t,e,n,r,i){this.semicoli.push(t);let s=this.findBaseIndex(this.data.length-1),a=this.initialState.id+1;-1!==s&&(a=this.data[s].state.id+1),this.data.push({state:e,marker:n,error:!1,output:this.computeNewStateOutput(e,a,r,i),successCounter:i})}addIncompleteSemicolon(t){this.semicoli.push(t),this.data.push({state:null,marker:-1,error:!1,output:"",successCounter:0})}addErrorSemicolon(t,e,n){this.semicoli.push(t),this.data.push({state:null,marker:n,error:!0,output:"\\3"+e,successCounter:0})}addSMLErrorSemicolon(t,e,n){this.semicoli.push(t);let r="\\*Uncaught SML exception\\*: "+this.outputEscape(e.toString())+"\n";this.data.push({state:null,marker:n,error:!0,output:"\\3"+r,successCounter:0})}outputEscape(t){return t.replace(/\\/g,"\\\\")}printBasis(t,e,n,r=0){let i="",s=">",a=new Date;9===a.getMonth()&&a.getDate()>=25?s="🎃":11===a.getMonth()&&a.getDate()>=24&&a.getDate()<=26?s="🎄":11===a.getMonth()&&31===a.getDate()?s="🎊":0===a.getMonth()&&1===a.getDate()?s="🎆":1===a.getMonth()&&14===a.getDate()?s="🍫":2===a.getMonth()&&14===a.getDate()?s="🍫":6===a.getMonth()&&7===a.getDate()&&(s="🎋");let o=0===r?s:" ",l="";for(let t=0;t<r;++t)l+="  ";if(void 0===e){for(let e in n.valueEnvironment)n.valueEnvironment.hasOwnProperty(e)&&(i+=o+" "+l+this.printBinding(t,[e,void 0,n.getValue(e)])+"\n");for(let e in n.typeEnvironment)if(n.typeEnvironment.hasOwnProperty(e)&&"CustomType"===n.getType(e).type.typeName()){i+=o+" "+l+"datatype \\*"+n.getType(e).type+"\\* : {\n";for(let r of n.getType(e).constructors)i+="    "+l+this.printBinding(t,[r,void 0,n.getValue(r)])+"\n";i+="  "+l+"};\n"}for(let t in n.typeEnvironment)n.typeEnvironment.hasOwnProperty(t)&&"FunctionType"===n.getType(t).type.typeName()&&(i+=o+" "+l+"type \\*"+n.getType(t).type.parameterType+" = "+n.getType(t).type.returnType+"\\*;\n");for(let e in n.structureEnvironment)n.structureEnvironment.hasOwnProperty(e)&&(i+=o+" "+l+"structure \\*"+e+"\\*: sig\n",i+=n?this.printBasis(t,void 0,n.getStructure(e),r+1):this.printBasis(t,void 0,void 0,r+1),i+="  "+l+"end;\n")}else{for(let r in e.valueEnvironment)e.valueEnvironment.hasOwnProperty(r)&&(i+=n?o+" "+l+this.printBinding(t,[r,e.valueEnvironment[r],n.getValue(r)],!1)+"\n":o+" "+l+this.printBinding(t,[r,e.valueEnvironment[r],void 0],!1)+"\n");for(let r in e.typeEnvironment)if(e.typeEnvironment.hasOwnProperty(r)&&n.typeEnvironment.hasOwnProperty(r)&&"CustomType"===n.getType(r).type.typeName()){i+=o+" "+l+"datatype \\*"+n.getType(r).type+"\\* = {\n";for(let s of n.getType(r).constructors)i+="    "+l+this.printBinding(t,[s,e.valueEnvironment[s],n.getValue(s)])+"\n";i+="  "+l+"};\n"}for(let t in e.typeEnvironment)e.typeEnvironment.hasOwnProperty(t)&&n.typeEnvironment.hasOwnProperty(t)&&"FunctionType"===n.getType(t).type.typeName()&&(i+=o+" "+l+"type \\*"+n.getType(t).type.parameterType+" = "+n.getType(t).type.returnType+"\\*;\n");for(let s in e.structureEnvironment)e.structureEnvironment.hasOwnProperty(s)&&(i+=o+" "+l+"structure \\*"+s+"\\* = struct\n",i+=n?this.printBasis(t,e.getStructure(s),n.getStructure(s),r+1):this.printBasis(t,e.getStructure(s),void 0,r+1),i+="  "+l+"end;\n")}return i}computeNewStateOutput(t,e,n,i){let s=i%2==0?"\\1":"\\2",a="";try{let n=t;for(let i=t.id;i>=e;--i)for(n.id===i&&(a=r.disableEvaluation?this.printBasis(n,void 0,n.getStaticChanges(i-1),0)+a:this.printBasis(n,n.getDynamicChanges(i-1),n.getStaticChanges(i-1),0)+a);n.id>=i;)n=n.parent}catch(n){a=r.disableEvaluation?this.printBasis(t,void 0,t.getStaticChanges(e-1),0):this.printBasis(t,t.getDynamicChanges(e-1),t.getStaticChanges(e-1),0)}let o=!1;for(let t=0;t<n.length;++t)n[t].type>=-1?a+=this.outputEscape("WARN: "+n[t].message):a+=this.outputEscape("Printed: "+n[t].message),o=!n[t].message.endsWith("\n");return""===a.trim()&&(a="(no output)\n"),o&&(a+="\n"),a=s+a}printBinding(t,e,n=!0){let r,i,s="",a=e[1];void 0!==a&&(r=a[0]);let o=e[2];void 0!==o&&(i=o[0]);let l=r?r.typeName():i.typeName();return s+="ValueConstructor"===l&&n?"con":"ExceptionConstructor"===l?"exn":"val",r?i&&i.isOpaque()?s+=" \\*"+e[0]+" = <"+this.outputEscape(i.getOpaqueName())+">\\*":s+=" \\*"+e[0]+" = "+this.outputEscape(r.toString(t))+"\\*":s+=" \\*"+e[0]+"\\*",i?s+": \\_"+this.outputEscape(i.toString(t))+"\\_;":s+": undefined;"}stringArrayContains(t,e){for(let n=0;n<t.length;n++)if(-1!==t[n].indexOf(e))return!0;return!1}isHandlingNecessary(t,e,n){if(this.stringArrayContains(e,";")||this.stringArrayContains(n,";"))return!0;if(0===this.semicoli.length)return!1;let r=this.semicoli[this.semicoli.length-1];return-1!==this.compare(r,t)}findBaseIndex(t){for(let e=t;e>=0;e--)if(null!==this.data[e].state)return e;return-1}findNonErrorAnchor(t){for(let e=t;e>=0;e--)if(!this.data[e].error)return e;return-1}deleteAllAfter(t){this.semicoli.length=t+1;for(let e=t+1;e<this.data.length;e++)-1!==this.data[e].marker&&i.clearMarker(this.data[e].marker);this.data.length=t+1}binarySearch(t){let e=0,n=this.semicoli.length-1;for(;e<=n;){let r=Math.floor((e+n)/2),i=this.semicoli[r],s=this.compare(t,i);if(-1===s){if(e>(n=r-1))return r-1}else{if(1!==s)return r-1;if((e=r+1)>n)return r}}return-1}compare(t,e){return t.line===e.line?Math.sign(t.ch-e.ch):Math.sign(t.line-e.line)}}).go()}).call(this,n(1))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}]);